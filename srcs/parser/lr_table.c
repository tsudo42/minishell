/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   lr_table.c                                         :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: tsudo <tsudo@student.42tokyo.jp>           +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2022/07/01 00:00:00 by tsudo             #+#    #+#             */
/*   Updated: 2022/07/01 00:00:00 by tsudo            ###   ##########        */
/*                                                                            */
/* ************************************************************************** */

#include "lr_func.h"

/*
| #   | R   | W   | OP  | PPE | (   | )   | $   |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 0   | s7  | s8  |     |     | s5  |     |     |
| 1   |     |     | s9  |     |     |     | AC  |
| 2   |     |     | r2  | s10 |     | r2  | r2  |
| 3   |     |     | r5  | r5  |     | r5  | r5  |
| 4   | s7  | s8  | r6  | r6  |     | r6  | r6  |
| 5   | s7  | s8  |     |     | s5  |     |     |
| 6   | r10 | r10 | r10 | r10 |     | r10 | r10 |
| 7   |     | s13 |     |     |     |     |     |
| 8   | r12 | r12 | r12 | r12 |     | r12 | r12 |
| 9   | s7  | s8  |     |     | s5  |     |     |
| 10  | s7  | s8  |     |     | s5  |     |     |
| 11  | r9  | r9  | r9  | r9  |     | r9  | r9  |
| 12  |     |     | s9  |     |     | s17 |     |
| 13  | r11 | r11 | r11 | r11 |     | r11 | r11 |
| 14  |     |     | r1  | s10 |     | r1  | r1  |
| 15  |     |     | r3  | r3  |     | r3  | r3  |
| 16  | s7  | s8  | r4  | r4  |     | r4  | r4  |
| 17  | s19 |     | r8  | r8  |     | r8  | r8  |
| 18  | s20 |     | r7  | r7  |     | r7  | r7  |
| 19  |     | s21 |     |     |     |     |     |
| 20  |     | s22 |     |     |     |     |     |
| 21  | r14 |     | r14 | r14 |     | r14 | r14 |
| 22  | r13 |     | r13 | r13 |     | r13 | r13 |
*/

static int	lr_t_to_int(t_lr_token_type tok)
{
	if (tok == LR_T_RED)
		return (0);
	else if (tok == LR_T_WORD)
		return (1);
	else if (tok == LR_T_OP)
		return (2);
	else if (tok == LR_T_PIPE)
		return (3);
	else if (tok == LR_T_LBRACE)
		return (4);
	else if (tok == LR_T_RBRACE)
		return (5);
	else if (tok == LR_T_EOL)
		return (6);
	else
		return (-1);
}

/***
 *  typedef enum e_lr_action_type {
 *  	LR_ACT_SHIFT = 1,
 *  	LR_ACT_REDUCE = 2,
 *  	LR_ACT_ACCEPT = 3,
 *  	LR_ACT_ERROR = -1
 *  }	t_lr_action_type;
 */

t_lr_action_type	lr_action(t_lr_token_type tok, int state)
{
	static const int	action_table[23][7] = {{1, 1, -1, -1, 1, -1, -1},
	{-1, -1, 1, -1, -1, -1, 3}, {-1, -1, 2, 1, -1, 2, 2},
	{-1, -1, 2, 2, -1, 2, 2}, {1, 1, 2, 2, -1, 2, 2},
	{1, 1, -1, -1, 1, -1, -1}, {2, 2, 2, 2, -1, 2, 2},
	{-1, 1, -1, -1, -1, -1, -1}, {2, 2, 2, 2, -1, 2, 2},
	{1, 1, -1, -1, 1, -1, -1}, {1, 1, -1, -1, 1, -1, -1},
	{2, 2, 2, 2, -1, 2, 2}, {-1, -1, 1, -1, -1, 1, -1},
	{2, 2, 2, 2, -1, 2, 2}, {-1, -1, 2, 1, -1, 2, 2},
	{-1, -1, 2, 2, -1, 2, 2}, {1, 1, 2, 2, -1, 2, 2},
	{1, -1, 2, 2, -1, 2, 2}, {1, -1, 2, 2, -1, 2, 2},
	{-1, 1, -1, -1, -1, -1, -1}, {-1, 1, -1, -1, -1, -1, -1},
	{2, -1, 2, 2, -1, 2, 2}, {2, -1, 2, 2, -1, 2, 2}};

	if (lr_t_to_int(tok) < 0 || state < 0 || state >= 23)
		return (LR_ACT_ERROR);
	return (action_table[state][lr_t_to_int(tok)]);
}

int	lr_action_param(t_lr_token_type tok, int state)
{
	static const int	param_table[23][7] = {{7, 8, -1, -1, 5, -1, -1},
	{-1, -1, 9, -1, -1, -1, 0}, {-1, -1, 2, 10, -1, 2, 2},
	{-1, -1, 5, 5, -1, 5, 5}, {7, 8, 6, 6, -1, 6, 6},
	{7, 8, -1, -1, 5, -1, -1}, {10, 10, 10, 10, -1, 10, 10},
	{-1, 13, -1, -1, -1, -1, -1}, {12, 12, 12, 12, -1, 12, 12},
	{7, 8, -1, -1, 5, -1, -1}, {7, 8, -1, -1, 5, -1, -1},
	{9, 9, 9, 9, -1, 9, 9}, {-1, -1, 9, -1, -1, 17, -1},
	{11, 11, 11, 11, -1, 11, 11}, {-1, -1, 1, 10, -1, 1, 1},
	{-1, -1, 3, 3, -1, 3, 3}, {7, 8, 4, 4, -1, 4, 4},
	{19, -1, 8, 8, -1, 8, 8}, {20, -1, 7, 7, -1, 7, 7},
	{-1, 21, -1, -1, -1, -1, -1}, {-1, 22, -1, -1, -1, -1, -1},
	{14, -1, 14, 14, -1, 14, 14}, {13, -1, 13, 13, -1, 13, 13}};

	if (lr_t_to_int(tok) < 0 || state < 0 || state >= 23)
		return (-1);
	return (param_table[state][lr_t_to_int(tok)]);
}

/*
| #   | L   | P   | S   | C   | A   | D   |
| --- | --- | --- | --- | --- | --- | --- |
| 0   | 1   | 2   | 3   | 4   | 6   |     |
| 1   |     |     |     |     |     |     |
| 2   |     |     |     |     |     |     |
| 3   |     |     |     |     |     |     |
| 4   |     |     |     |     | 11  |     |
| 5   | 12  | 2   | 3   | 4   | 6   |     |
| 6   |     |     |     |     |     |     |
| 7   |     |     |     |     |     |     |
| 8   |     |     |     |     |     |     |
| 9   |     | 14  | 3   | 4   | 6   |     |
| 10  |     |     | 15  | 16  | 6   |     |
| 11  |     |     |     |     |     |     |
| 12  |     |     |     |     |     |     |
| 13  |     |     |     |     |     |     |
| 14  |     |     |     |     |     |     |
| 15  |     |     |     |     |     |     |
| 16  |     |     |     |     | 11  |     |
| 17  |     |     |     |     |     | 18  |
| 18  |     |     |     |     |     |     |
| 19  |     |     |     |     |     |     |
| 20  |     |     |     |     |     |     |
| 21  |     |     |     |     |     |     |
| 22  |     |     |     |     |     |     |
*/

static int	lr_n_to_int(t_lr_token_type tok)
{
	if (tok == LR_N_L)
		return (0);
	else if (tok == LR_N_P)
		return (1);
	else if (tok == LR_N_S)
		return (2);
	else if (tok == LR_N_C)
		return (3);
	else if (tok == LR_N_A)
		return (4);
	else if (tok == LR_N_D)
		return (5);
	else
		return (-1);
}

int	lr_goto(t_lr_token_type tok, int state)
{
	static const int	goto_table[23][6] = {{1, 2, 3, 4, 6, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, -1, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, 11, -1},
	{12, 2, 3, 4, 6, -1}, {-1, -1, -1, -1, -1, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, -1, -1},
	{-1, 14, 3, 4, 6, -1}, {-1, -1, 15, 16, 6, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, -1, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, -1, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, 11, -1},
	{-1, -1, -1, -1, -1, 18}, {-1, -1, -1, -1, -1, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, -1, -1},
	{-1, -1, -1, -1, -1, -1}, {-1, -1, -1, -1, -1, -1}};

	if (lr_n_to_int(tok) < 0 || state < 0 || state >= 23)
		return (-1);
	return (goto_table[state][lr_n_to_int(tok)]);
}
